language: ruby

services:
  - docker

before_install:
- docker build -t rafavilvert/sherlock:${TRAVIS_JOB_ID} .
- docker run rafavilvert/sherlock:${TRAVIS_JOB_ID} /bin/sh -c "yarn install --check-files"

script:
- docker run -it rafavilvert/sherlock:${TRAVIS_JOB_ID} rspec


deploy:
  provider: script
  script: bash echo "$DOCKER_PASS" | docker login -u "$DOCKER_USER" --password-stdin
  script: docker push rafavilvert/sherlock:${TRAVIS_JOB_ID}
  provider: pages
  git-hub-token: $GITHUB_TOKEN
  on:
    branch: master
